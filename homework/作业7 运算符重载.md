# 作业7 运算符重载

## 一、目的

- 掌握运算符重载

- 实现对Matrix类的运算符重载

## 二、内容

在之前的实验中，我们实现了矩阵类Matrix及其子类Image。本次实验我们给Matrix类添加一些重载的运算符，包括赋值运算符“=”，两个Matrix对象的“+”、“-”、“\*”、“/”（都是矩阵对应元素间的运算，而不是矩阵的乘除），自加自减，矩阵（或图像）对象和一个数（标量）的“=”、“+”、“-”、“\*”、“/”操作，判断两个矩阵（或图像）是否相等的“==”。

给Image类添加一个单目运算符“-”，作用是图像的像素值取反，即黑的变成白的，白的变成黑的。再给Image类添加一个成员函数gray2bw，该函数以给定的阈值参数把灰度图像转化为二值图像。假设图像的像素值范围在[0,1]之间的实数，给定阈值$double\ t\in[0,1]$。该函数对图像中的所有像素做如下处理：如果该像素的像素值小于t，则输出图像对应像素值赋值为0，如果该像素的像素值大于等于t，则输出图像对应像素赋值为1。此函数的输出图像对象仅含有0和1两种像素值，因此该操作在图像处理里称为“二值化”操作或“阈值分割”。

**注意：**这两种函数假设操作对象的数据是在[0,1]之间的实数。但是实际对象的元素数值可能不在这个范围内。因此，在这两个函数内部，需要先把所有元素的范围normalize到[0,1]区间，然后再做相应的操作。同样，在把结果保存为BMP图像的时候，要把范围再缩放到[0,255]的整数区间，注意相关的操作。

示例图片中有两幅场景图scene2_bg.bmp和scene2_fg.bmp，要求通过图像相减，再做阈值分割，分离出前景物体。

1. 在Matrix类中重载运算符，添加一些运算符重载函数（有的是成员函数，有的是友元函数，思考哪些适合使用成员函数，哪些适合使用友元函数？）：

    (1) 重载两个Matrix对象的赋值运算符“=”，完成类似a=b的操作。要求进行数据的深拷贝。并再次重载赋值运算符，使右操作数可以是一个double类型的数，完成矩阵所有元素赋值为该数，如a=128。

    (2) 重载判断两个Matrix对象是否相等的“==”运算符，两个矩阵相等的条件是行列大小相同，所有元素的值也相等。

    (3) 重载“+”运算符，针对两幅尺寸相同的矩阵，完成对应元素值相加。

    (4) 重载“+”运算符，实现一个矩阵所有元素加上同一数值。

    (5) 重载“-”运算符，针对两个尺寸相同的矩阵，实现对元素值相减。

    (6) 重载“-”运算符，实现一个矩阵所有元素减去同一数值。

    (7) 重载“*”运算符，针对两个尺寸相同的矩阵，实现对元素值相乘。

    (8) 重载“*”运算符，实现一个矩阵所有元素乘以同一数值。

    (9) 重载“/”运算符，针对两个尺寸相同的矩阵，实现对元素值相除；自己设计除数为0时的处理办法。

    (10) 重载“/”运算符，实现一个矩阵所有元素除以同一数值；自己设计除数为0时的处理办法。

2. 在Image类里，实现如下运算符和函数：

    (1) 重载“-”单目运算符，实现一个Image对象的所有元素“取反”。

    (2) 实现函数gray2bw，以给定的阈值对图像进行二值化，函数返回结果Image对象。

    (3) 重载“++”运算符，实现一个矩阵所有元素自加1（分别实现前置版本和后置版本）。注意，使用该运算符的对象的像素值范围应该是[0,255]，如果是[0,1]之间的，应该首先扩展到[0,255]，再进行加1操作，然后再normalize回[0,1]。

    (4) 重载“--”运算符，实现一个矩阵所有元素自减1（分别实现前置版本和后置版本）。注意，使用该运算符的对象的像素值范围应该是[0,255]，如果是[0,1]之间的，应该首先扩展到[0,255]，再进行加1操作，然后再normalize回[0,1]。

3. 在main函数中对所有实现的函数进行测试，比如前面提到的分离前景物体。

    创建Image对象img1和img2，分别读入两幅图像scene2_fg和scene2_bg。新建Image对象sub，使用“-”运算符，实现img1和img2相减，并保存。对sub调用gray2bw函数进行阈值分割，保存结果。

## 代码示例

***Matrix.h***

```c++
#ifndef MATRIX_H
#define MATRIX_H 

class Matrix
{
public:

    // 构造函数等其它成员略

    //运算符重载函数；

	Matrix& operator=(const Matrix &m);  //重载赋值运算符，完成对象间的深拷贝；
 
	bool operator==(const Matrix &m);    //判断两个Matrix对象是否相等

    Matrix& operator++();    //前置自加；
    Matrix& operator--();    //前置自减；
    Matrix operator++(int);  //后置自加；
    Matrix operator--(int);  //后置自减；

	//两个尺寸相同的矩阵，对应元素的数值相加；
	friend Matrix operator+(const Matrix &m1, const Matrix &m2);

    //所有元素加上同一数值;
    friend Matrix operator+(Matrix &m, double num);

    //两个尺寸相同的矩阵，对应元素的数值相减；
    friend Matrix operator-(const Matrix &m1, const Matrix &m2);  

    //所有元素减去同一数值;
    friend Matrix operator-(Matrix &m, double num);

    //两幅尺寸相同的矩阵，对应元素的数值相乘；
    friend Matrix operator*(const Matrix &m1, const Matrix &m2);

    //所有元素乘上同一数值;
    friend Matrix operator*(Matrix &m, double num);

    //两幅尺寸相同的矩阵，对应元素的数值相除；
    friend Matrix operator/( const Matrix &m1, const Matrix &m2);

    //所有元素除以同一数值;
    friend Matrix operator/(Matrix &m, double num);

	//以上友元函数实现了Matrix对象和一个数的加减乘除，如果交换这两个操作数，即一个数和一个Matrix对象的加减乘除，应该如何做？请自行写出相关代码。

	//其它成员略

};
 
#endif
```

在Image类中实现Image特有的运算符和成员函数。

```c++
	Image operator-();  //对图像取反，把所有像素的值都规整到[0,1]之间，然后每个像素都被1.0减

	Image gray2bw(double t); //以给定阈值t对图像进行二值化，返回结果图像对象；

	自加、自减的前置版本和后置版本
```

***实现文件略***

## 实验要求

完成上述代码，实现相应功能，鼓励在以上功能基础上增添设计新功能。